apiVersion: v1
kind: ConfigMap
metadata:
  name: neurobridge-config
  namespace: neurobridge
data:
  LOG_MODE: "production"
  PORT: "8080"

  POSTGRES_HOST: "127.0.0.1"
  POSTGRES_PORT: "5432"
  POSTGRES_USER: "neurobridge"
  POSTGRES_NAME: "neurobridge"
  CLOUD_SQL_CONNECTION_NAME: "wise-vim-480800-n2:us-central1:neurobridge-postgres"

  REDIS_ADDR: "10.172.72.28:6379"
  REDIS_CHANNEL: "sse"

  ACCESS_TOKEN_TTL: "3600"
  REFRESH_TOKEN_TTL: "86400"
  NONCE_REFRESH_TTL: "86400"

  GCP_PROJECT_ID: "wise-vim-480800-n2"
  AVATAR_GCS_BUCKET_NAME: "neurobridge-avatar"
  MATERIAL_GCS_BUCKET_NAME: "neurobridge-materials"
  AVATAR_CDN_DOMAIN: "cdn.neurobridge.dev"
  MATERIAL_CDN_DOMAIN: "cdn.neurobridge.dev"
  GOOGLE_APPLICATION_CREDENTIALS: "/run/secrets/gcp_sa.json"
  GOOGLE_APPLICATION_CREDENTIALS_JSON: "/run/secrets/gcp_sa.json"

  AVATAR_COLORS_JSON_PATH: "/app/json/colors/avatar.json"
  AVATAR_FONT: "/app/fonts/Riforma-Bold.ttf"

  DOCUMENTAI_LOCATION: "us"
  DOCUMENTAI_PROCESSOR_ID: "16d4b30508b6d96d"
  DOCUMENTAI_PROCESSOR_VERSION: "pretrained-ocr-v2.0-2023-06-02"
  VISION_OCR_OUTPUT_PREFIX: "gs://neurobridge-materials/extraction/vision/"

  PINECONE_API_VERSION: "2025-10"
  PINECONE_BASE_URL: "https://api.pinecone.io"
  PINECONE_INDEX_NAME: "neurobridge"
  PINECONE_INDEX_HOST: "neurobridge-u9fnjgj.svc.gcp-us-central1-4a9f.pinecone.io"
  PINECONE_NAMESPACE_PREFIX: "nb"

  OPENAI_BASE_URL: "https://api.openai.com"
  OPENAI_MODEL: "gpt-5.2"
  OPENAI_EMBED_MODEL: "text-embedding-3-large"
  OPENAI_IMAGE_MODEL: "gpt-image-1.5"
  OPENAI_IMAGE_SIZE: "1024x1024"
  OPENAI_VIDEO_MODEL: "sora-2"
  OPENAI_VIDEO_SIZE: "1280x720"
  OPENAI_TIMEOUT_SECONDS: "180"
  OPENAI_RESPONSES_TIMEOUT_SECONDS: "600"
  OPENAI_MAX_RETRIES: "4"
  OPENAI_VISION_TIMEOUT_SECONDS: "60"

  WORKER_CONCURRENCY: "40"

  # Library taxonomy (path organization)
  LIBRARY_TAXONOMY_MAX_MEMBERSHIPS_PER_FACET: "4"
  LIBRARY_TAXONOMY_MAX_NEW_NODES_PER_FACET: "2"
  LIBRARY_TAXONOMY_ASSIGN_SIMILARITY_THRESHOLD_PCT: "82"
  LIBRARY_TAXONOMY_RELATED_SIMILARITY_THRESHOLD_PCT: "88"
  LIBRARY_TAXONOMY_MAX_RELATED_PER_NODE: "4"
  LIBRARY_TAXONOMY_REFINE_NEW_PATHS_THRESHOLD: "5"
  LIBRARY_TAXONOMY_REFINE_UNSORTED_THRESHOLD: "3"
  LIBRARY_TAXONOMY_REFINE_LOCK_MINUTES: "30"
  LIBRARY_TAXONOMY_REFINE_MAX_NEW_NODES_PER_FACET: "3"
  LIBRARY_TAXONOMY_MIN_CATEGORY_PATHS: "3"
  LIBRARY_TAXONOMY_ANCHOR_MIN_PATHS_FOR_CHILD: "5"
  LIBRARY_TAXONOMY_CLUSTER_COHESION_THRESHOLD_PCT: "82"
  LIBRARY_TAXONOMY_SECONDARY_ANCHOR_MIN_SIMILARITY_THRESHOLD_PCT: "88"
  LIBRARY_TAXONOMY_SECONDARY_ANCHOR_MAX_GAP_PCT: "2"

  SAGA_CLEANUP_OLDER_HOURS: ""
  SAGA_CLEANUP_LIMIT: ""

  LEARNING_BUILD_MODE: ""
  LEARNING_BUILD_MIN_POLL_MS: "2000"
  LEARNING_BUILD_MAX_POLL_MS: "10000"
  LEARNING_BUILD_CHILD_MAX_MINUTES: "50"
  LEARNING_BUILD_CHILD_STALE_RUNNING_MINUTES: "10"
  LEARNING_BUILD_HEAD_NODES: "2"

  # Concept graph
  CONCEPT_GRAPH_EXCERPTS_PER_FILE: "14"
  CONCEPT_GRAPH_EXCERPT_MAX_CHARS: "700"
  CONCEPT_GRAPH_EXCERPT_MAX_LINES: "0"
  CONCEPT_GRAPH_EXCERPT_MAX_TOTAL_CHARS: "0"
  CONCEPT_GRAPH_EDGE_EXCERPT_MAX_LINES: "0"
  CONCEPT_GRAPH_EDGE_EXCERPT_MAX_CHARS: "700"
  CONCEPT_GRAPH_EDGE_EXCERPT_MAX_TOTAL_CHARS: "0"
  CONCEPT_GRAPH_HEARTBEAT_SECONDS: "20"
  CONCEPT_GRAPH_EMBED_BATCH_SIZE: "64"
  CONCEPT_GRAPH_EMBED_CONCURRENCY: "20"
  CONCEPT_GRAPH_PINECONE_BATCH_SIZE: "64"
  CONCEPT_GRAPH_PINECONE_CONCURRENCY: "20"

  EMBED_CHUNKS_BATCH_SIZE: "64"
  EMBED_CHUNKS_CONCURRENCY: "20"

  NODE_CONTENT_BUILD_CONCURRENCY: "20"
  NODE_DOC_BUILD_CONCURRENCY: "20"
  NODE_DOC_BUILD_POLL_MS: "1500"
  NODE_DOC_MUST_CITE_PER_NODE: "2"
  NODE_DOC_DIAGRAMS_LIMIT: "0"
  NODE_FIGURES_PLAN_CONCURRENCY: "20"
  NODE_FIGURES_RENDER_CONCURRENCY: "20"
  NODE_FIGURES_RENDER_LIMIT: "0"
  NODE_FIGURES_RENDER_POLL_MS: "1500"
  NODE_VIDEOS_PLAN_CONCURRENCY: "20"
  NODE_VIDEOS_RENDER_CONCURRENCY: "20"
  NODE_VIDEOS_RENDER_LIMIT: "0"
  NODE_VIDEOS_RENDER_POLL_MS: "1500"

  INGEST_CHUNKS_FILE_TIMEOUT_MINUTES: "10"
  INGEST_CHUNKS_JOB_TIMEOUT_MINUTES: "30"
  INGEST_CHUNKS_HEARTBEAT_SECONDS: "3"
